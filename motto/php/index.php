<?php	header("Content-Type:text/html; charset=utf-8");    require_once dirname(__FILE__).'/pscws4.class.php';	include dirname(__FILE__).'/html_dom.php';		$q_ary = array();	$q_ary[] = $_GET['q'];		$query = n_to_w( $_GET['q'], 0 );    $pscws = new PSCWS4('utf8');    $pscws->set_dict('etc/dict_cht.utf8.xdb');    $pscws->set_rule('etc/rules.ini');    $pscws->send_text( $query );    $result = $pscws->get_result();  		$result_str = '';	$result_str_temp = '';    // 取得結果的所有詞彙    foreach( $result as $a ){        //$a['attr']		if( (int)$a['idf'] != 0 ){			$result_str_temp = $result_str_temp.'+'.$a['word'];		}		$result_str = $result_str.'+'.$a['word'];	}	$q_ary[] = n_to_w( $result_str, 1 );	if( empty($result_str_temp) )		$q_ary[] = n_to_w( $result_str, 1 );	else		$q_ary[] = n_to_w( $result_str_temp, 1 );			$q_res = array(); $test='';	for( $i=0; $i<3; $i++ ){		$ch = curl_init();		curl_setopt ($ch, CURLOPT_URL, 'http://www.google.com.tw/search?q='.rawurlencode( $q_ary[$i] ).'');		curl_setopt ($ch, CURLOPT_USERAGENT, 'Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1');		curl_setopt ($ch, CURLOPT_RETURNTRANSFER, true);		curl_setopt ($ch, CURLOPT_CONNECTTIMEOUT, 5);		curl_setopt ($ch, CURLOPT_AUTOREFERER, true);		curl_setopt ($ch, CURLOPT_SSL_VERIFYPEER, false);		curl_setopt ($ch, CURLOPT_SSL_VERIFYHOST, 2);		$html = curl_exec($ch);		curl_close($ch);		$q_res[] = $q_ary[$i];		$html_dom = str_get_html( $html );		$res = $html_dom->find('#resultStats'); 		foreach( $res as $key => $val ){			$q_res[] = strip_tags( $val );			$test = $test.','.strip_tags( $val );		}	}	echo json_encode( (object)$q_res );?><?phpfunction n_to_w($strs, $types = '0'){  // narrow to wide , or wide to narrow    $nt = array(        "(", ")", "[", "]", "{", "}", ".", ",", ";", ":",        "-", "?", "!", "@", "#", "$", "%", "&", "|", "\\",        "/", "+", "=", "*", "~", "`", "'", "\"", "<", ">",        "^", "_", " "    );    $wt = array(        "（", "）", "〔", "〕", "｛", "｝", "﹒", "，", "；", "：",        "－", "？", "！", "＠", "＃", "＄", "％", "＆", "｜", "＼",        "／", "＋", "＝", "＊", "～", "、", "、", "＂", "＜", "＞",        "︿", "＿", "　"    );     if ($types == '0'){        // narrow to wide        $strtmp = str_replace($nt, $wt, $strs);    }else{        // wide to narrow        $strtmp = str_replace($wt, $nt, $strs);    }    return $strtmp;}?>